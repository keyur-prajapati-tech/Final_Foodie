@{
    Layout = "~/Views/Shared/_RestaurantLayout.cshtml";
}

@model Foodie.Models.customers.MenuItemViewModel

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Restaurant Dashboard | FoodOrder System</title>
    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <style>
        .menu-highlights-section {
            padding: 40px 0;
        }

            .menu-highlights-section h2 {
                font-size: 2rem;
                margin-bottom: 10px;
            }

        .menu-item-card {
            height: 100%;
            transition: transform 0.3s;
        }

            .menu-item-card:hover {
                transform: translateY(-5px);
                box-shadow: 0 10px 20px rgba(0,0,0,0.1);
            }

        .card-img-top {
            height: 180px;
            object-fit: cover;
        }

        .no-image-placeholder {
            height: 180px;
            background: #f5f5f5;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #888;
        }

        .menu-item-details {
            display: flex;
            justify-content: space-between;
            margin: 15px 0;
        }

        .price {
            font-weight: bold;
            color: #e63946;
        }

        .rating {
            color: #666;
        }
    </style>
</head>
<body>
    <!-- Main Content -->
    <div class="main-content mt-3">
        <!-- Header -->
        <div class="dashboard-header d-flex justify-content-between align-items-center">
            <div>
                <h2 class="mb-1"><i class="fas fa-tachometer-alt me-2 text-primary"></i>Restaurant Dashboard</h2>
                <p class="text-muted mb-0" style="font-weight: 800">Welcome back! Here's what's happening with your restaurant today.</p>
            </div>
            <div>
                <button class="btn btn-primary me-2" data-bs-toggle="modal" data-bs-target="#addItemModal">
                    <i class="fas fa-plus me-1"></i> Add Menu Item
                </button>
                <button class="btn btn-light position-relative">
                    <i class="fas fa-bell text-dark"></i>
                    <span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger">
                        3+
                    </span>
                </button>
            </div>
        </div>

        <!-- Stats Cards -->
        <div class="row g-4 mt-3">
             <div class="col-xl-3 col-md-6">
                <div class="card h-100" style="border: 3px solid solid;border-radius:5px; box-shadow:0px 0px 5px 5px rgba(0,0,0,.9)">
                    <div class="card-body" style="border: 3px solid solid;border-radius:5px; box-shadow:0px 0px 5px 5px rgba(0,0,0,.9)">
                        <div class="d-flex justify-content-between align-items-start">
                            <div>
                                <h6 class="text-muted mb-2">Active Orders</h6>
                                <h2 class="mb-1">18</h2>
                                <span class="badge bg-success bg-opacity-10 text-success">+5 new</span>
                            </div>
                            <div class="bg-primary bg-opacity-10 p-3 rounded">
                                <i class="fas fa-concierge-bell text-primary fs-4"></i>
                            </div>
                        </div>
                        <div class="mt-3">
                            <small class="text-muted"><i class="fas fa-clock me-1"></i> Updated just now</small>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-xl-3 col-md-6">
                <div class="card h-100 border-0 shadow-sm">
                    <div class="card-body" style="border: 3px solid solid;border-radius:5px; box-shadow:0px 0px 5px 5px rgba(0,0,0,.9)">
                        <div class="d-flex justify-content-between align-items-start">
                            <div>
                                <h6 class="text-muted mb-2">Today's Revenue</h6>
                                <h2 class="mb-1">RS 1,845</h2>
                                <span class="badge bg-success bg-opacity-10 text-success">+12%</span>
                            </div>
                            <div class="bg-success bg-opacity-10 p-3 rounded">
                                <i class="fas fa-dollar-sign text-success fs-4"></i>
                            </div>
                        </div>
                        <div class="mt-3">
                            <small class="text-muted"><i class="fas fa-calendar-day me-1"></i> Compared to yesterday</small>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-xl-3 col-md-6">
                <div class="card h-100 border-0 shadow-sm">
                    <div class="card-body" style="border: 3px solid solid;border-radius:5px; box-shadow:0px 0px 5px 5px rgba(0,0,0,.9)">
                        <div class="d-flex justify-content-between align-items-start">
                            <div>
                                <h6 class="text-muted mb-2">New Customers</h6>
                                <h2 class="mb-1">9</h2>
                                <span class="badge bg-success bg-opacity-10 text-success">+3 this week</span>
                            </div>
                            <div class="bg-secondary bg-opacity-10 p-3 rounded">
                                <i class="fas fa-users text-secondary fs-4"></i>
                            </div>
                        </div>
                        <div class="mt-3">
                            <small class="text-muted"><i class="fas fa-chart-line me-1"></i> 15% conversion rate</small>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-xl-3 col-md-6">
                <div class="card h-100 border-0 shadow-sm">
                    <div class="card-body" style="border: 3px solid solid;border-radius:5px; box-shadow:0px 0px 5px 5px rgba(0,0,0,.9)">
                        <div class="d-flex justify-content-between align-items-start">
                            <div>
                                <h6 class="text-muted mb-2">Menu Items</h6>
                                <h2 class="mb-1">42</h2>
                                <span class="badge bg-danger bg-opacity-10 text-danger">5 low stock</span>
                            </div>
                            <div class="bg-warning bg-opacity-10 p-3 rounded">
                                <i class="fas fa-utensils text-warning fs-4"></i>
                            </div>
                        </div>
                        <div class="mt-3">
                            <small class="text-muted"><i class="fas fa-star me-1"></i> 12 featured items</small>
                        </div>
                    </div>
                </div>
            </div> 
        </div>

        <!--RecentOrder And popular Item display-->
        <div class="row mt-4 g-4">
            <div class="col-lg-8">
                <div class="card" style="border: 3px solid solid;border-radius:5px; box-shadow:0px 0px 5px 5px rgba(0,0,0,.9)">
                    <div class="card-header bg-white d-flex justify-content-between align-items-center border-0">
                        <div>
                            <h5 class="mb-0"><i class="fas fa-list-ul me-2 text-dark"></i>Recent Orders</h5>
                            <p class="text-muted mb-0 small">Latest customer orders that need attention</p>
                        </div>
                        <a href="/OrderHistory/OrdHistory" class="btn btn-sm btn-outline-primary">
                            View All <i class="fas fa-arrow-right ms-1"></i>
                        </a>
                    </div>
                    <div class="card-body p-0">
                        <div class="table-responsive">
                            <table class="table table-hover mb-0">
                                <thead>
                                    <tr>
                                        <th>Order #</th>
                                        <th>Customer</th>
                                        <th>Items</th>
                                        <th>Total</th>
                                        <th>Status</th>
                                        <th>Action</th>
                                    </tr>
                                </thead>
                                <tbody id="recentOrdersContainer">
                                    <!-- Orders will be loaded here -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <div class="col-lg-4">
                <div class="card" style="border: 3px solid solid;border-radius:5px; box-shadow:0px 0px 5px 5px rgba(0,0,0,.9)">
                    <div class="card-header bg-white d-flex justify-content-between align-items-center border-0">
                        <div>
                            <h5 class="mb-0"><i class="fas fa-fire me-2 text-warning"></i>Popular Items</h5>
                            <p class="text-muted mb-0 small">Most ordered items this week</p>
                        </div>
                        <a href="/Menu/Add" class="btn btn-sm btn-outline-primary">
                            View Menu <i class="fas fa-arrow-right ms-1"></i>
                        </a>
                    </div>
                    <div class="card-body p-0">
                        <div class="list-group list-group-flush" id="popularItemsContainer">
                            <!-- Popular items will be loaded here -->
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Menu Wise Order And Revenue -->
        <div class="row mt-4 g-4">
            <div class="col-12" id="menu-wise-state-container">
                <div class="card" style="border: 3px solid solid;border-radius:5px; box-shadow:0px 0px 5px 5px rgba(0,0,0,.9)">
                    <div class="card-header bg-white d-flex justify-content-between align-items-center border-0">
                        <div>
                            <h5 class="mb-0"><i class="fas fa-chart-pie me-2 text-primary"></i>Menu Wise Order & Revenue</h5>
                            <p class="text-muted mb-0 small">Performance by menu category</p>
                        </div>
                        <div class="btn-group" role="group">
                            <button class="btn btn-sm btn-outline-primary active">This Week</button>
                            <button class="btn btn-sm btn-outline-primary">This Month</button>
                            <button class="btn btn-sm btn-outline-primary">This Year</button>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table table-bordered">
                                <thead class="table-light">
                                    <tr>
                                        <th>Menu Category</th>
                                        <th class="text-end">Orders</th>
                                        <th class="text-end">Revenue</th>
                                        <th class="text-end">Avg. Order Value</th>
                                        <th class="text-end">% of Total</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>Main Course</td>
                                        <td class="text-end">128</td>
                                        <td class="text-end">$2,845.50</td>
                                        <td class="text-end">$22.23</td>
                                        <td class="text-end">
                                            <div class="d-flex align-items-center justify-content-end">
                                                <span class="me-2">42%</span>
                                                <div class="progress flex-grow-1" style="width: 100px; height: 5px;">
                                                    <div class="progress-bar bg-primary" role="progressbar" style="width: 42%"></div>
                                                </div>
                                            </div>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>Appetizers</td>
                                        <td class="text-end">86</td>
                                        <td class="text-end">$1,245.75</td>
                                        <td class="text-end">$14.49</td>
                                        <td class="text-end">
                                            <div class="d-flex align-items-center justify-content-end">
                                                <span class="me-2">28%</span>
                                                <div class="progress flex-grow-1" style="width: 100px; height: 5px;">
                                                    <div class="progress-bar bg-success" role="progressbar" style="width: 28%"></div>
                                                </div>
                                            </div>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>Desserts</td>
                                        <td class="text-end">64</td>
                                        <td class="text-end">$845.20</td>
                                        <td class="text-end">$13.21</td>
                                        <td class="text-end">
                                            <div class="d-flex align-items-center justify-content-end">
                                                <span class="me-2">21%</span>
                                                <div class="progress flex-grow-1" style="width: 100px; height: 5px;">
                                                    <div class="progress-bar bg-warning" role="progressbar" style="width: 21%"></div>
                                                </div>
                                            </div>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>Beverages</td>
                                        <td class="text-end">45</td>
                                        <td class="text-end">$345.60</td>
                                        <td class="text-end">$7.68</td>
                                        <td class="text-end">
                                            <div class="d-flex align-items-center justify-content-end">
                                                <span class="me-2">9%</span>
                                                <div class="progress flex-grow-1" style="width: 100px; height: 5px;">
                                                    <div class="progress-bar bg-info" role="progressbar" style="width: 9%"></div>
                                                </div>
                                            </div>
                                        </td>
                                    </tr>
                                    <tr class="table-active">
                                        <td class="fw-bold">Total</td>
                                        <td class="text-end fw-bold">323</td>
                                        <td class="text-end fw-bold">$5,282.05</td>
                                        <td class="text-end fw-bold">$16.35</td>
                                        <td class="text-end fw-bold">100%</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Sales Analytics & Quick Actions -->
        <div class="row mt-4 g-4" style="border: 3px solid solid;border-radius:5px; box-shadow:0px 0px 5px 5px rgba(0,0,0,.9)">
            <div class="col-lg-8">
                <div class="card border-0 shadow-sm">
                    <div class="card-header bg-white d-flex justify-content-between align-items-center border-0">
                        <div>
                            <h5 class="mb-0"><i class="fas fa-chart-line me-2 text-success"></i>Weekly Performance</h5>
                            <p class="text-muted mb-0 small">Orders and revenue comparison</p>
                        </div>
                        <div class="btn-group" role="group">
                            <button class="btn btn-sm btn-outline-primary active">This Week</button>
                            <button class="btn btn-sm btn-outline-primary">Last Week</button>
                            <button class="btn btn-sm btn-outline-primary">Monthly</button>
                        </div>
                    </div>
                    <div class="card-body">
                        <canvas id="salesChart" height="120"></canvas>
                    </div>
                </div>
            </div>
            <div class="col-lg-4">
                <div class="card border-0 shadow-sm">
                    <div class="card-header bg-white border-0">
                        <h5 class="mb-0"><i class="fas fa-bolt me-2 text-primary"></i>Quick Actions</h5>
                        <p class="text-muted mb-0 small">Common tasks for your restaurant</p>
                    </div>
                    <div class="card-body">
                        <div class="d-grid gap-3">
                            <button class="btn btn-light text-start">
                                <div class="d-flex align-items-center">
                                    <div class="bg-primary bg-opacity-10 p-2 rounded me-3">
                                        <i class="fas fa-edit text-primary"></i>
                                    </div>
                                    <div>
                                        <h6 class="mb-0">Update Today's Specials</h6>
                                        <small class="text-muted">Set featured menu items</small>
                                    </div>
                                </div>
                            </button>
                            <button class="btn btn-light text-start">
                                <div class="d-flex align-items-center">
                                    <div class="bg-success bg-opacity-10 p-2 rounded me-3">
                                        <i class="fas fa-tag text-success"></i>
                                    </div>
                                    <div>
                                        <h6 class="mb-0">Create New Promotion</h6>
                                        <small class="text-muted">Discounts and offers</small>
                                    </div>
                                </div>
                            </button>
                            <button class="btn btn-light text-start">
                                <div class="d-flex align-items-center">
                                    <div class="bg-info bg-opacity-10 p-2 rounded me-3">
                                        <i class="fas fa-envelope text-info"></i>
                                    </div>
                                    <div>
                                        <h6 class="mb-0">Send Customer Offers</h6>
                                        <small class="text-muted">Email promotions</small>
                                    </div>
                                </div>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Menu Items Preview -->
        <div class="menu-highlights-section">
            <h2>Menu Highlights</h2>
            <p>Featured items from your menu</p>

            <div id="menuHighlightsContainer" class="row">
                <!-- Menu items will be loaded here dynamically -->
            </div>
        </div>

    </div>

    <!-- Add Item Modal -->
    <div class="modal fade" id="addItemModal" tabindex="-1" aria-labelledby="addItemModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="addItemModalLabel"><i class="fas fa-plus-circle me-2"></i>Add New Menu Item</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form>
                        <div class="row g-3">
                            <div class="col-md-6">
                                <label for="itemName" class="form-label">Item Name</label>
                                <input type="text" class="form-control" id="itemName" placeholder="e.g. Margherita Pizza">
                            </div>
                            <div class="col-md-6">
                                <label for="itemCategory" class="form-label">Category</label>
                                <select class="form-select" id="itemCategory">
                                    <option selected>Select category</option>
                                    <option>Appetizers</option>
                                    <option>Main Course</option>
                                    <option>Desserts</option>
                                    <option>Beverages</option>
                                    <option>Specials</option>
                                </select>
                            </div>
                            <div class="col-md-6">
                                <label for="itemPrice" class="form-label">Price</label>
                                <div class="input-group">
                                    <span class="input-group-text">$</span>
                                    <input type="number" class="form-control" id="itemPrice" placeholder="0.00" step="0.01">
                                </div>
                            </div>
                            <div class="col-md-6">
                                <label for="itemPrepTime" class="form-label">Preparation Time (mins)</label>
                                <input type="number" class="form-control" id="itemPrepTime" placeholder="e.g. 20">
                            </div>
                            <div class="col-12">
                                <label for="itemDescription" class="form-label">Description</label>
                                <textarea class="form-control" id="itemDescription" rows="3" placeholder="Brief description of the item"></textarea>
                            </div>
                            <div class="col-12">
                                <label for="itemImage" class="form-label">Item Image</label>
                                <input class="form-control" type="file" id="itemImage" accept="image/*">
                                <small class="text-muted">Recommended size: 800x600 pixels</small>
                            </div>
                            <div class="col-md-6">
                                <div class="form-check form-switch">
                                    <input class="form-check-input" type="checkbox" id="isVegetarian" checked>
                                    <label class="form-check-label" for="isVegetarian">
                                        Vegetarian
                                    </label>
                                </div>
                                <div class="form-check form-switch mt-2">
                                    <input class="form-check-input" type="checkbox" id="isGlutenFree">
                                    <label class="form-check-label" for="isGlutenFree">
                                        Gluten Free
                                    </label>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-check form-switch">
                                    <input class="form-check-input" type="checkbox" id="isAvailable" checked>
                                    <label class="form-check-label" for="isAvailable">
                                        Available Now
                                    </label>
                                </div>
                                <div class="form-check form-switch mt-2">
                                    <input class="form-check-input" type="checkbox" id="isFeatured">
                                    <label class="form-check-label" for="isFeatured">
                                        Featured Item
                                    </label>
                                </div>
                            </div>
                            <div class="col-12">
                                <label for="itemIngredients" class="form-label">Ingredients</label>
                                <textarea class="form-control" id="itemIngredients" rows="2" placeholder="List main ingredients (comma separated)"></textarea>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary">
                        <i class="fas fa-save me-1"></i> Save Item
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap 5 JS Bundle with Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Custom JS -->
    <script>
        // Initialize sales chart
        document.addEventListener('DOMContentLoaded', function() {
            const ctx = document.getElementById('salesChart').getContext('2d');
            const salesChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'],
                    datasets: [{
                        label: 'Orders',
                        data: [12, 19, 15, 20, 25, 30, 28],
                        backgroundColor: 'rgba(13, 110, 253, 0.7)',
                        borderColor: 'rgba(13, 110, 253, 1)',
                        borderWidth: 1
                    },
                    {
                        label: 'Revenue ($)',
                        data: [450, 680, 520, 740, 920, 1100, 980],
                        backgroundColor: 'rgba(25, 135, 84, 0.7)',
                        borderColor: 'rgba(25, 135, 84, 1)',
                        borderWidth: 1,
                        type: 'line',
                        yAxisID: 'y1'
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Number of Orders'
                            }
                        },
                        y1: {
                            position: 'right',
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Revenue ($)'
                            },
                            grid: {
                                drawOnChartArea: false
                            }
                        }
                    }
                }
            });
        });

        $(document).ready(function(){
            loadDashboardData();
            loadMenuHighlights();
            loadRecentOrders();
            loadPopularItems();
        });

        function loadDashboardData() {
            $.ajax({
                url: '/Restaurant/GetDashboardData',
                type: 'GET',
                dataType: 'json',
                success: function(response) {
                    console.log("Dashboard Data:", response);
                    if (response.success) {
                        renderRecentOrders(response.data.RecentOrders);
                        renderPopularItems(response.data.PopularItems);
                    }
                },
                error: function(xhr, status, error) {
                    console.error('Error loading dashboard data:', error);
                }
            });
        }

        function loadMenuHighlights() {
            $.ajax({
                url: '/Restaurant/GetMenuHighlights',
                type: 'GET',
                dataType: 'json',
                success: function (data) {
                    console.log(data);
                    renderMenuItems(data, '#menuHighlightsContainer');
                },
                error: function (xhr, status, error) {
                    console.error('Error loading menu highlights:', error);
                }
            });
        }

        function renderMenuItems(items, containerSelector) {
            var container = $(containerSelector);
            container.empty();

            // Create the full card structure with header
            var menuHtml = `
            <div class="row mt-4">
                <div class="col-12" style="border-radius:5px; box-shadow:0px 0px 5px 5px rgba(0,0,0,.1)">
                    <div class="card border-0 shadow-sm">
                        <div class="card-header bg-white d-flex justify-content-between align-items-center border-0">
                            <div>
                                <h5 class="mb-0"><i class="fas fa-utensils me-2 text-warning"></i>Menu Highlights</h5>
                                <p class="text-muted mb-0 small">Featured items from your menu</p>
                            </div>
                            <a href="@Url.Action("Menu", "Restaurant")" class="btn btn-sm btn-outline-primary">
                                View All <i class="fas fa-arrow-right ms-1"></i>
                            </a>
                        </div>
                        <div class="card-body">
                            <div class="row g-4">
            `;

            // Add each menu item
            $.each(items, function (index, item) {
                // Determine badge type based on sales
                var badgeType = "";
                var badgeText = "";
                if (item.totalQuantitySold > 100) {
                    badgeType = "bg-primary";
                    badgeText = "Bestseller";
                } else if (item.totalQuantitySold > 50) {
                    badgeType = "bg-warning text-dark";
                    badgeText = "Trending";
                } else {
                    badgeType = "bg-info";
                    badgeText = "New";
                }

                // Truncate description to 2 lines
                var shortDescription = item.menuDescription.length > 100 ?
                    item.menuDescription.substring(0, 100) + "..." :
                    item.menuDescription;

                menuHtml += `
                <div class="col-xl-3 col-lg-4 col-md-6">
                    <div class="card h-100 border">
                        <div class="position-relative">
                            <a href="#" class="image-modal-trigger" data-bs-toggle="modal" data-bs-target="#menuItemModal"
                               data-name="${item.menuName}"
                               data-description="${item.menuDescription}"
                               data-image="${item.menuImageBase64 ? 'data:image/jpeg;base64,' + item.menuImageBase64 : ''}">
                                ${item.menuImageBase64 ?
                        `<img src="data:image/jpeg;base64,${item.menuImageBase64}" class="card-img-top" alt="${item.menuName}" style="height: 150px; object-fit: cover; cursor: pointer;">` :
                        `<div class="card-img-top bg-light d-flex align-items-center justify-content-center" style="height: 150px; cursor: pointer;">
                                        <i class="fas fa-utensils fa-3x text-muted"></i>
                                     </div>`}
                            </a>
                            <span class="badge ${badgeType} position-absolute top-0 start-0 m-2">${badgeText}</span>
                        </div>
                        <div class="card-body">
                            <h5 class="card-title">${item.menuName || 'Menu Item'}</h5>
                            <p class="card-text text-muted small" style="display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; text-overflow: ellipsis;">
                                ${shortDescription}
                            </p>
                            <div class="d-flex justify-content-between align-items-center">
                                <span class="text-success fw-bold">RS ${item.amount || '0'} /-</span>
                                <div>
                                    <span class="badge bg-light text-dark me-1">
                                        <i class="fas fa-clock me-1"></i> ${item.preparationTime || '15'} min
                                    </span>
                                    <span class="badge bg-light text-dark">
                                        <i class="fas fa-star me-1 text-warning"></i> ${item.rating || '4.5'}
                                    </span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                `;
            });

            // Close all divs
            menuHtml += `
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Bootstrap Modal -->
            <div class="modal fade" id="menuItemModal" tabindex="-1" aria-labelledby="menuItemModalLabel" aria-hidden="true">
                <div class="modal-dialog modal-dialog-centered modal-lg">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="menuItemModalLabel">Menu Item Details</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body">
                            <div class="row">
                                <div class="col-md-6">
                                    <img id="modalItemImage" src="" class="img-fluid rounded" alt="Menu Item" style="max-height: 400px; width: 100%; object-fit: cover;">
                                    <div id="modalNoImage" class="bg-light d-flex align-items-center justify-content-center" style="height: 400px; display: none;">
                                        <i class="fas fa-utensils fa-5x text-muted"></i>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <h3 id="modalItemName" class="mb-3"></h3>
                                    <p id="modalItemDescription" class="lead"></p>
                                    <div class="d-flex align-items-center mb-3">
                                        <span class="badge bg-success me-2">RS <span id="modalItemPrice">0</span> /-</span>
                                        <span class="badge bg-info me-2"><i class="fas fa-clock me-1"></i> <span id="modalItemTime">15</span> min</span>
                                        <span class="badge bg-warning"><i class="fas fa-star me-1"></i> <span id="modalItemRating">4.5</span></span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            `;

            container.append(menuHtml);

            // Add click handler for modal
            $(document).on('click', '.image-modal-trigger', function () {
                var name = $(this).data('name');
                var description = $(this).data('description');
                var image = $(this).data('image');

                $('#modalItemName').text(name);
                $('#modalItemDescription').text(description);
                $('#modalItemPrice').text($(this).closest('.card').find('.text-success').text().replace('RS ', '').replace(' /-', ''));
                $('#modalItemTime').text($(this).closest('.card').find('.fa-clock').parent().text().trim().replace('min', '').trim());
                $('#modalItemRating').text($(this).closest('.card').find('.fa-star').parent().text().trim());

                if (image) {
                    $('#modalItemImage').attr('src', image).show();
                    $('#modalNoImage').hide();
                } else {
                    $('#modalItemImage').hide();
                    $('#modalNoImage').show();
                }
            });
        }

        function loadRecentOrders() {
            $.ajax({
                url: '/Restaurant/GetrecentOrders',
                type: 'GET',
                dataType: 'json',
                success: function (response) {
                    console.log("Recent Order Data " + response.data);

                    if (response.success) {
                        renderRecentOrders(response.data);
                    }
                },
                error: function (xhr, status, error) {
                    console.error('Error loading recent orders:', error);
                }
            });
        }

        function loadPopularItems() {
            $.ajax({
                url: '/Restaurant/GetPopularItems',
                type: 'GET',
                dataType: 'json',
                success: function (response) {
                    console.log("Popular Menu Items Data "+response.data)
                    if (response.success) {
                        renderPopularItems(response.data);
                    }
                },
                error: function (xhr, status, error) {
                    console.error('Error loading popular items:', error);
                }
            });
        }

        function renderRecentOrders(orders) {
            var container = $('#recentOrdersContainer');
            container.empty();

            if (!orders || orders.length === 0) {
                container.html('<tr><td colspan="6" class="text-center py-4">No recent orders found</td></tr>');
                return;
            }

            $.each(orders, function (index, order) {
                var statusClass = '';
                var statusText = '';
                var actionBtn = '';

                // Determine status styling and action button
                switch (order.order_status) {
                    case 'Pending':
                        statusClass = 'bg-warning bg-opacity-10 text-warning';
                        statusText = 'Pending';
                        actionBtn = `<button class="btn btn-sm btn-outline-primary rounded-pill px-3">
                                        <i class="fas fa-utensils me-1"></i> Process
                                      </button>`;
                        break;
                    case 'Paid':
                        statusClass = 'bg-info bg-opacity-10 text-info';
                        statusText = 'Paid';
                        actionBtn = `<button class="btn btn-sm btn-outline-warning rounded-pill px-3">
                                        <i class="fas fa-clock me-1"></i> Update
                                      </button>`;
                        break;
                    case 'completed':
                        statusClass = 'bg-success bg-opacity-10 text-success';
                        statusText = 'completed';
                        actionBtn = `<button class="btn btn-sm btn-success rounded-pill px-3">
                                        <i class="fas fa-check me-1"></i> Complete
                                      </button>`;
                        break;
                    case 'Accepted':
                        statusClass = 'bg-success bg-opacity-10 text-success';
                        statusText = 'Accepted';
                        actionBtn = `<button class="btn btn-sm btn-info rounded-pill px-3">
                                        <i class="fas fa-check me-1"></i> Complete
                                      </button>`;
                        break;
                    default:
                        statusClass = 'bg-secondary bg-opacity-10 text-secondary';
                        statusText = order.order_status;
                        actionBtn = `<button class="btn btn-sm btn-outline-secondary rounded-pill px-3">
                                        <i class="fas fa-info-circle me-1"></i> Details
                                      </button>`;
                }

                var orderHtml = `
                <tr>
                    <td class="fw-bold">#ORD-${order.order_id}</td>
                    <td>
                        <div class="d-flex align-items-center">
                            <img src="https://ui-avatars.com/api/?name=${encodeURIComponent(order.customer_name || '')}&background=random"
                                 class="rounded-circle me-2" width="30" height="30" alt="${order.customer_name || ''}">
                            <span>${order.customer_name || 'Customer'}</span>
                        </div>
                    </td>
                    <td>${order.temCount  || 0}</td>
                    <td class="fw-bold">RS ${(order.grand_total || 0).toFixed(2)}</td>
                    <td><span class="badge ${statusClass}">${statusText}</span></td>
                    <td>${actionBtn}</td>
                </tr>`;

                container.append(orderHtml);
            });
        }

        function renderPopularItems(items) {
            var container = $('#popularItemsContainer');
            container.empty();

            if (!items || items.length === 0) {
                container.html('<div class="text-center py-4">No popular items found</div>');
                return;
            }

            $.each(items, function(index, item) {
                var itemHtml = `
                <a href="#" class="list-group-item list-group-item-action">
                    <div class="d-flex justify-content-between align-items-center">
                        <div class="d-flex align-items-center">
                            ${item.menuImg ?
                                `<img src="data:image/jpeg;base64,${item.menuImg}" class="rounded me-3" width="50" height="50" alt="${item.MenuName}">` :
                                `<div class="rounded me-3 bg-light d-flex align-items-center justify-content-center" style="width:50px;height:50px">
                                    <i class="fas fa-utensils text-muted"></i>
                                 </div>`}
                            <div>
                                <h6 class="mb-0">${item.menuName || 'Menu Item'}</h6>
                                <small class="text-muted">${item.cuisine_name || 'Category'} • ${item.OrderCount || 0} orders</small>
                            </div>
                        </div>
                        <span class="text-success fw-bold">RS ${item.amount} /-</span>
                    </div>
                </a>`;

                container.append(itemHtml);
            });
        }
    </script>
</body>
</html>